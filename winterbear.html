<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãã¾ã•ã‚“ã® ãµã‚†ã”ã‚‚ã‚Š</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#e0f4ff">

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
}

body {
  font-family: "Rounded Mplus 1c", sans-serif;
  background: #e0f4ff;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  -webkit-tap-highlight-color: transparent;
}

.snow {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  background-image:
    radial-gradient(2px 2px at 20% 10%, #fff, transparent),
    radial-gradient(3px 3px at 80% 20%, #fff, transparent),
    radial-gradient(2px 2px at 40% 30%, #fff, transparent),
    radial-gradient(3px 3px at 60% 50%, #fff, transparent);
  animation: snow 10s linear infinite;
  z-index: 0;
}

.snow.heavy {
  animation-duration: 6s;
}

@keyframes snow {
  from { background-position: 0 0; }
  to { background-position: 0 100vh; }
}

body > *:not(.snow) {
  position: relative;
  z-index: 1;
}

#bear {
  width: 30%;
  margin: 20px auto;
  animation: bounce 2s infinite;
}

#end_bear {
  width: 80%;
  margin: 20px auto;
}

.sleeping {
  animation: sleep 4s infinite;
}

@keyframes bounce {
  0%,100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

@keyframes sleep {
  0%,100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.box {
  background: #fff;
  border-radius: 20px;
  padding: 15px;
  margin: 10px;
  width: 90%;
  max-width: 400px;
}

button {
  font-size: 18px;
  padding: 12px 20px;
  margin: 5px;
  border-radius: 20px;
  border: none;
  background: #ffcc80;
  min-width: 160px;
}

button:disabled {
  background: #ccc;
}

#ending {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #fff0f5;
  display: none;
  padding-top: 100px;
  z-index: 10;
  animation: fadeIn 2s;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
</style>
</head>

<body>
<div class="snow"></div>

<h1>ğŸ» ãã¾ã•ã‚“ã® ãµã‚†ã”ã‚‚ã‚Š</h1>

<img id="bear" src="img/bear_normal.png" alt="ãã¾">

<div class="box">
  <p>ğŸ è„‚è‚ª: <span id="fat">30</span></p>
  <p>ğŸ’– ä½“åŠ›: <span id="hp">30</span></p>
  <p>ğŸ‚ æ®‹ã‚Šæ—¥æ•°: <span id="days">10</span></p>
  <p>ğŸ† ã‚¹ã‚³ã‚¢: <span id="score">0</span></p>
  <p>â­ ãƒã‚¤ã‚¹ã‚³ã‚¢: <span id="highScore">0</span></p>

  <button id="gatherBtn" class="game-btn" onclick="gather()">é£Ÿã¹ç‰©ã‚’ã‚ã¤ã‚ã‚‹</button>
  <button id="restBtn" class="game-btn" onclick="rest()">ä¼‘ã‚€</button>
</div>

<div class="box">
  <p id="message">å†¬ã«ããªãˆã‚ˆã†ï¼</p>
  <button id="sleepBtn" class="game-btn" id="sleepBtn" onclick="hibernate()" >
    å†¬çœ ã™ã‚‹
  </button>
</div>

<div id="ending">
  <img id="end_bear" src="img/bear_clear.png" alt="ãã¾">
  <h2 id="endingTitle">ğŸŒ¸ æ˜¥ãŒããŸã‚ˆï¼ ğŸŒ¸</h2>
  <p id="endingMessage">ãã¾ã•ã‚“ã¯å…ƒæ°—ã«å†¬ã‚’ã“ã—ã¾ã—ãŸ</p>
  <p id="scoreLine">
    ğŸ† æœ€çµ‚ã‚¹ã‚³ã‚¢: <span id="finalScore"></span>
  </p>
  <button class="ending-btn" onclick="restart()">ã‚‚ã†ä¸€å›ã‚ãã¶</button>
</div>

<audio id="seTap" src="sound/tap.mp3"></audio>
<audio id="seSleep" src="sound/sleep.mp3"></audio>
<audio id="seClear" src="sound/clear.mp3"></audio>

<script>
let fat = 30;
let hp = 30;
let days = 10;
let score = 0;
let highScore = 0;
let sleeping = false;
let gameOver = false;

function playSE(id) {
  const se = document.getElementById(id);
  se.currentTime = 0;
  se.play();
}

function updateBearFace() {
  const bear = document.getElementById("bear");

  if (gameOver) {
    bear.src = "img/bear_frozen.png";
    return;
  }

  if (sleeping) {
    bear.src = "img/bear_sleep.png";
  } else if (fat < 30 || hp < 30) {
    bear.src = "img/bear_bad.png";
  } else if (fat < 50 || hp < 50) {
    bear.src = "img/bear_ok.png";
  } else {
    bear.src = "img/bear_normal.png";
  }
}

function update() {
  fat = Math.min(fat, 100);
  hp = Math.min(hp, 100);
  score = fat * 10 + hp * 5;

  document.getElementById("fat").textContent = fat;
  document.getElementById("hp").textContent = hp;
  document.getElementById("days").textContent = days;
  document.getElementById("score").textContent = score;
  document.getElementById("highScore").textContent = highScore;

  // æ—¥æ•°ãŒ0ã«ãªã£ãŸã‚‰æº–å‚™è¡Œå‹•ã‚’æ­¢ã‚ã‚‹
  if (days <= 0 && !sleeping && !gameOver) {
    document.getElementById("gatherBtn").disabled = true;
    document.getElementById("restBtn").disabled = true;
    document.getElementById("sleepBtn").disabled = false;
  }

  updateBearFace();

  if (days <= 0 && !sleeping) {
    document.getElementById("sleepBtn").disabled = false;
    document.getElementById("message").textContent = "â„ï¸ å†¬ãŒããŸï¼å†¬çœ ã—ã‚ˆã†";
  }
}

function gather() {
  
  playSE("seTap");
  fat += 10;
  hp -= 5;
  days--;
  document.getElementById("message").textContent = "ğŸ é£Ÿã¹ç‰©ã‚’ã‚ã¤ã‚ãŸï¼";
  update();
}

function rest() {
  playSE("seTap");
  hp += 10;
  days--;
  document.getElementById("message").textContent = "ğŸ˜´ ã²ã¨ã‚„ã™ã¿â€¦";
  update();
}

function hibernate() {
  playSE("seSleep");
  sleeping = true;
  document.querySelector(".snow").classList.add("heavy");
  document.getElementById("bear").classList.add("sleeping");
  document.querySelectorAll(".game-btn").forEach(b => b.disabled = true);
  document.getElementById("message").textContent = "ğŸ’¤ ã™ã‚„ã™ã‚„â€¦";

  const timer = setInterval(() => {
    fat -= Math.floor(Math.random() * 8 + 3);
    update();

	if (fat <= 0) {
	  clearInterval(timer);
	  gameOver = true;

	  document.getElementById("message").textContent ="ğŸ§Š ã•ã‚€ã™ãã¦ ã†ã”ã‘ãªã„â€¦";
	  
	  document.getElementById("end_bear").src = "img/bear_frozen.png";

      document.querySelectorAll(".game-btn").forEach(b => b.disabled = true);

	  updateBearFace();
	  gameOverShow();
	}
	
    if (fat > 0 && Math.random() < 0.2) {
      clearInterval(timer);
      gameClear();
    }
  }, 1000);
}

function gameClear() {
  playSE("seClear");

  if (score > highScore) {
    highScore = score;
    localStorage.setItem("hibernationHighScore", highScore);
  }

  document.getElementById("finalScore").textContent = score;
  document.getElementById("ending").style.display = "block";
}

function restart() {
  fat = 30;
  hp = 30;
  days = 10;
  score = 0;
  sleeping = false;
  gameOver = false;

  document.getElementById("ending").style.display = "none";
  document.getElementById("scoreLine").style.display = "block";

  document.getElementById("endingTitle").textContent = "ğŸŒ¸ æ˜¥ãŒããŸã‚ˆï¼ ğŸŒ¸";
  document.getElementById("endingMessage").textContent ="ãã¾ã•ã‚“ã¯å…ƒæ°—ã«å†¬ã‚’ã“ã—ã¾ã—ãŸ";
  document.getElementById("end_bear").src = "img/bear_clear.png";

  document.getElementById("message").textContent = "å†¬ã«ããªãˆã‚ˆã†ï¼";
  document.getElementById("sleepBtn").disabled = true;

  document.getElementById("bear").classList.remove("sleeping");
  document.querySelector(".snow").classList.remove("heavy");

  document.querySelectorAll(".game-btn").forEach(b => b.disabled = false);
  update();
}

function loadHighScore() {
  const saved = localStorage.getItem("hibernationHighScore");
  highScore = saved ? Number(saved) : 0;
}

function gameOverShow() {
  document.getElementById("endingTitle").textContent = "ğŸ§Š ã•ã‚€ã™ãã¦ ã†ã”ã‘ãªã„â€¦";
  document.getElementById("endingMessage").textContent = "ãã¾ã•ã‚“ã¯å†¬ã‚’ã“ã›ãªã‹ã£ãŸâ€¦";

  document.getElementById("scoreLine").style.display = "none";

  document.getElementById("ending").style.display = "block";
}


loadHighScore();
update();

// ç–‘ä¼¼ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³
document.body.addEventListener("click", () => {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen().catch(()=>{});
  }
}, { once: true });
</script>

</body>
</html>
